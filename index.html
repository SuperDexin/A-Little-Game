<script language="JavaScript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chromle</title>
	<style>
		body{
			margin: 0 auto;
			width: 90%;
		}

		div{
			width: 100%;
			font-size: 200%;
		}

		button{
			font-size: 200%;
		}

		@media (orientation: landscape) {
			button{
				font-size: 100%;
			}
		}
	</style>

	<script>
		"use strict";
		var colors = ['çº¢', 'ç»¿', 'é»„', 'è“', 'ç´«', 'æ©™','æ£•','é»‘','ç™½'];

		var example_question = ["çº¢", "é»„", "çº¢", "ç»¿", "ç»¿", "è“", "æ©™", "ç»¿", "ç™½"];
        var example_answer = ["é»„", "é»„", "è“", "ç»¿", "ç´«", "ç»¿", "çº¢", "ç»¿", "ç´«"];

		var question = new Array(9);
		var answers = new Array(9);

		var nownum = 0;
		var round = 0;

		var answers_bool = true;

		var if_success = false;

		var char_color_bool = false;

        var color_quantity = 5;

		function choose(ID) {
			if (nownum >= 0 && nownum < color_quantity && !if_success) {
				answers[nownum] = Number(ID);
				nownum += 1;
				let content = (round+1) + ": ";
				for (let i=0; i<nownum; i++) {
					content = content+" "+colors[answers[i]];
				}
				document.getElementById("answer_region").innerHTML=content;
			}
		}

		function del() {
			if (nownum > 0 && nownum <= color_quantity) {
				nownum -= 1;
				let content = (round+1) + ": ";
				for (let i=0; i<nownum; i++) {
					content = content+" "+colors[answers[i]];
				}
				document.getElementById("answer_region").innerHTML=content;
			}
		}

		function submit() {
			if (nownum === color_quantity) {
				show();
			}
		}

		function show() {
			round++;
			let content1 = round + ": ";
			for (let i=0; i<color_quantity; i++) {
				content1 = content1+" "+colors[answers[i]];
			}
			const [location_num, num_num] = match();
			let content2 = "" + location_num + "ä¸ªä½ç½®é¢œè‰²æ­£ç¡® " + num_num + "ç§é¢œè‰²æ•°é‡æ­£ç¡®";

			let Content1 = document.createTextNode(content1);
			let Content2 = document.createTextNode(content2);

			document.getElementById("answer").appendChild(Content1);
			document.getElementById("answer").appendChild(document.createElement("br"));
			document.getElementById("answer").appendChild(Content2);
			document.getElementById("answer").appendChild(document.createElement("br"));

			let content3;
			let Content3;
			if (location_num === color_quantity) {
				content3 = "Congratulations!"
				Content3 = document.createTextNode(content3);
				let para = document.createElement("p");
				para.setAttribute("style","color: red; font-size: 210%;");
				para.appendChild(Content3);
				document.getElementById("answer").appendChild(para);
				let num = 0;
				for (let i=0; i<color_quantity; i++) {
					num <<= 3;
					num += question[i];
				}
				const base_url = location.href.replace(location.hash, "");
				document.getElementById("answer_region").innerHTML
					= "å¦‚æœä½ æƒ³å’Œå¥½å‹åˆ†äº«æœ¬å±€çš„é—®é¢˜ï¼Œå¯ä»¥å¤åˆ¶ä»¥ä¸‹é“¾æ¥ï¼š"
					+ `<a href="${base_url}#${num}">${base_url}#${num}</a>`;
				if_success = true;
			}
			else{
				document.getElementById("answer_region").innerHTML=(round+1) + ":";
			}

			nownum = 0;
		}

		var hash_used = false;

		function refresh() {
			try {
				if (hash_used) {
					throw 1;
				} else {
					hash_used = true;
					if (location.hash === "") {
						throw 1;
					}
					let num = Number(location.hash.slice(1));
					if (Number.isNaN(num)) {
						throw 1;
					}
					let question_from_hash = [];
					for (let i=0; i<color_quantity; i++) {
						question_from_hash.unshift(num & 0b111);
						if (question_from_hash[0] >= color_quantity) {
							throw 1;
						}
						num >>= 3;
					}
					question = question_from_hash;
				}
			}
			catch (e) {
				for (let i=0; i<color_quantity; i++) {
					question[i] = Math.floor((Math.random() * color_quantity));
				}
			}

			document.getElementById("head").innerHTML="Chromle";
			document.getElementById("answer").innerHTML="";
			document.getElementById("answer_region").innerHTML="1:";
			round = 0;
			nownum = 0;
			answers_bool = true;
			if_success = false;
			document.getElementById("check_answer").innerHTML="æ˜¾ç¤ºç­”æ¡ˆ";
			change_button_num();
		}

		function match() {
			let location_num = 0;
			let answers_color_num = count(answers);
			let question_color_num = count(question);
			let num_num = 0;
			for (let i=0; i<color_quantity; i++) {
				if (question[i] === answers[i]) {
					location_num ++;
				}
				if ((answers_color_num[i] === question_color_num[i]) && (answers_color_num[i] !== 0)) {
					num_num++;
				}
			}
			return [location_num, num_num];
		}

		function count(array) {
			let color_num = [0,0,0,0,0];
			for (let i=0; i<color_quantity; i++) {
				color_num[array[i]] ++;
			}
			return color_num;
		}

		function show_answer() {
			let content = "";
			let button_content;
			if (!answers_bool) {
				button_content = "æ˜¾ç¤ºç­”æ¡ˆ";
				content = "Chromle";
			}
			if (answers_bool) {
				for (let i=0; i<color_quantity; i++) {
					content = content+" "+colors[question[i]];
				}
				button_content = "éšè—ç­”æ¡ˆ";
			}
			document.getElementById("head").innerHTML=content;
			document.getElementById("check_answer").innerHTML=button_content;
			answers_bool = !answers_bool;
		}

		function switch_char_color() {
			if (char_color_bool) {
				colors = ['çº¢', 'ç»¿', 'é»„', 'è“', 'ç´«', 'æ©™','æ£•','é»‘','ç™½'];
				example_question = ["çº¢", "é»„", "çº¢", "ç»¿", "ç»¿", "è“", "æ©™", "ç»¿", "ç™½"];
        		example_answer = ["é»„", "é»„", "è“", "ç»¿", "ç´«", "ç»¿", "çº¢", "ç»¿", "ç´«"];
			}
			else{
				colors = ['ğŸŸ¥', 'ğŸŸ©', 'ğŸŸ¨', 'ğŸŸ¦', 'ğŸŸª', 'ğŸŸ§', 'ğŸŸ«', 'â¬›', 'â¬œ'];
				example_question = ["ğŸŸ¥", "ğŸŸ¨", "ğŸŸ¥", "ğŸŸ©", "ğŸŸ©", "ğŸŸ¦", "ğŸŸ§", "ğŸŸ©", "â¬œ"];
        		example_answer = ["ğŸŸ¨", "ğŸŸ¨", "ğŸŸ¦", "ğŸŸ©", "ğŸŸª", "ğŸŸ©", "ğŸŸ¥", "ğŸŸ©", "ğŸŸª"];
			}
			for (let i = 0; i<color_quantity; i++) {
				document.getElementById(i).innerHTML=colors[i];
			}

			let content = "";
			if (!answers_bool) {
				for (let i=0; i<color_quantity; i++) {
					content = content+" "+colors[question[i]];
				}
				document.getElementById("head").innerHTML=content;
			}
			
			change_rules();
			char_color_bool = !char_color_bool;
		}

        function shift_color_quantity(value){
        	value = parseInt(value);
            color_quantity = value;
            change_button_num();
            change_rules();
            refresh();
        }

        function change_rules(){
        	let i;
        	let example_loc = [0, 0, 0, 1, 2, 2, 2, 2, 3, 3];
        	let example_num = [0, 0, 0, 0, 1, 0, 2, 2, 2, 2];

        	let content = "â€œ";
            for(i=0; i < (color_quantity-1); i++){
            	content = content + colors[i] + "ã€";
            }
            content = content + colors[i] + "â€";
            document.getElementById("rule1").innerHTML="è§„åˆ™ï¼šä¸€å…±æœ‰" + color_quantity + "ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®ä¼šéšæœºç”Ÿæˆ" + content + color_quantity + "ç§é¢œè‰²ä¹‹ä¸€ï¼Œéœ€è¦æˆ‘ä»¬å»çŒœå‡ºç”Ÿæˆçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚<br>";

            content = "å¦‚ç”Ÿæˆâ€œ";
            for(i=0; i < (color_quantity-1); i++){
            	content = content + example_question[i] + "ã€";
            }
            content = content + example_question[i] + "â€ï¼ŒçŒœæµ‹â€œ";
            for(i=0; i < (color_quantity-1); i++){
            	content = content + example_answer[i] + "ã€";
            }
            content = content + example_answer[i] + "â€ï¼Œä¼šå‡ºç°â€œ" + example_loc[color_quantity] + "ä¸ªä½ç½®é¢œè‰²æ­£ç¡® " + example_num[color_quantity] + "ç§é¢œè‰²æ•°é‡æ­£ç¡®â€ã€‚<br>";
            document.getElementById("rule2").innerHTML=content;
            document.getElementById("rule3").innerHTML="å‡ºç°â€œ" + color_quantity + "ä¸ªä½ç½®é¢œè‰²æ­£ç¡®â€å³ç®—æˆåŠŸã€‚";
        }

        function change_button_num(){
        	$("#buttons").empty();
    		for(let i = 0; i < color_quantity; i++){
         		let button = document.createElement("button");
        		button.innerHTML = colors[i];
        		button.setAttribute("id", "" + i);
        		button.setAttribute("onClick", "choose(this.id)");
        		document.getElementById("buttons").appendChild(button);
    		}
        }

	</script>
</head>

<body>
	<div>
	<h1 id="head">Chromle</h1>
	<div style="font-size: 30%">
        <div id="rule1">è§„åˆ™ï¼šä¸€å…±æœ‰5ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®ä¼šéšæœºç”Ÿæˆçº¢ã€ç»¿ã€é»„ã€è“ã€ç´«äº”ç§é¢œè‰²ä¹‹ä¸€ï¼Œéœ€è¦æˆ‘ä»¬å»çŒœå‡ºç”Ÿæˆçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚<br></div>
		<div>æ¯çŒœæµ‹ä¸€æ¬¡ï¼Œå¯å¾—åˆ°ä¸¤æ¡ä¿¡æ¯ï¼š</div>
		<ol style="font-size: 200%">
			<li>æœ‰å‡ ä¸ªä½ç½®ä¸Šå‡ºç°çš„é¢œè‰²æ˜¯æ­£ç¡®çš„ï¼›</li>
			<li>æœ‰å‡ ä¸ªé¢œè‰²å‡ºç°çš„æ¬¡æ•°æ˜¯æ­£ç¡®çš„ï¼ˆä¸åŒ…æ‹¬çŒœå¯¹å‡ºç°0æ¬¡çš„é¢œè‰²ï¼‰ã€‚</li>
		</ol>
		<div id="rule2">å¦‚ç”Ÿæˆâ€œé»„ ç´« ç´« ç´« çº¢â€ï¼ŒçŒœæµ‹â€œé»„ ç´« é»„ çº¢ çº¢â€ï¼Œä¼šå‡ºç°â€œ3ä¸ªä½ç½®é¢œè‰²æ­£ç¡® 0ç§é¢œè‰²æ•°é‡æ­£ç¡®â€ã€‚<br></div>
		<div id="rule3">å‡ºç°â€œ5ä¸ªä½ç½®é¢œè‰²æ­£ç¡®â€å³ç®—æˆåŠŸã€‚</div>
	</div>
	<p id="answer"></p>
	<p></p>
	<p id="answer_region">1:</p>
	<p id="buttons">
		<button id="0" onclick="choose(this.id)">çº¢</button>
		<button id="1" onclick="choose(this.id)">ç»¿</button>
		<button id="2" onclick="choose(this.id)">é»„</button>
		<button id="3" onclick="choose(this.id)">è“</button>
		<button id="4" onclick="choose(this.id)">ç´«</button>
	</p>
	<p>
		<button onclick="submit()">ç¡®å®š</button>
		<button onclick="del()">åˆ é™¤</button>
		<button onclick="refresh()">æ¢ä¸€å±€</button>
		<button onclick="show_answer()" id="check_answer">æ˜¾ç¤ºç­”æ¡ˆ</button>
	</p>
    <p>
        <button onclick="switch_char_color()">åˆ‡æ¢é¢œè‰²æ˜¾ç¤ºæ–¹å¼</button>
    </p>
    <p>é€‰æ‹©é¢œè‰²ä¸ªæ•°
        <select id="color_num" style="font-size: 100%" onclick="shift_color_quantity(this.value)">
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5" selected="selected">5</option>
            <option value = "6">6</option>
            <option value = "7">7</option>
            <option value = "8">8</option>
            <option value = "9">9</option>
        </select>
    </p>

	</div>
	<script>
		refresh();
	</script>
</body>
</html>