<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chromle</title>
	<style>
		body{
			margin: 0 auto;
			width: 90%;
		}

		div{
			width: 100%;
			font-size: 200%;
		}

		button{
			font-size: 200%;
		}

		@media (orientation: landscape) {
			button{
				font-size: 100%;
			}
		}
	</style>

	<script>
		"use strict";
		var colors = ['çº¢', 'ç»¿', 'é»„', 'è“', 'ç´«'];

		var question = new Array(5);
		var answers = new Array(5);

		var nownum = 0;
		var round = 0;

		var answers_bool = true;

		var if_success = false;

		var char_color_bool = false;


		function choose(ID) {
			if (nownum >= 0 && nownum < 5 && !if_success) {
				answers[nownum] = Number(ID);
				nownum += 1;
				let content = (round+1) + ": ";
				for (let i=0; i<nownum; i++) {
					content = content+" "+colors[answers[i]];
				}
				document.getElementById("answer_region").innerHTML=content;
			}
		}

		function del() {
			if (nownum > 0 && nownum <= 5) {
				nownum -= 1;
				let content = (round+1) + ": ";
				for (let i=0; i<nownum; i++) {
					content = content+" "+colors[answers[i]];
				}
				document.getElementById("answer_region").innerHTML=content;
			}
		}

		function submit() {
			if (nownum === 5) {
				show();
			}
		}

		function show() {
			round++;
			let content1 = round + ": ";
			for (let i=0; i<5; i++) {
				content1 = content1+" "+colors[answers[i]];
			}
			const [location_num, num_num] = match();
			let content2 = "" + location_num + "ä¸ªä½ç½®é¢œè‰²æ­£ç¡® " + num_num + "ç§é¢œè‰²æ•°é‡æ­£ç¡®";

			let Content1 = document.createTextNode(content1);
			let Content2 = document.createTextNode(content2);

			document.getElementById("answer").appendChild(Content1);
			document.getElementById("answer").appendChild(document.createElement("br"));
			document.getElementById("answer").appendChild(Content2);
			document.getElementById("answer").appendChild(document.createElement("br"));

			let content3;
			let Content3;
			if (location_num === 5) {
				content3 = "Congratulations!"
				Content3 = document.createTextNode(content3);
				let para = document.createElement("p");
				para.setAttribute("style","color: red; font-size: 210%;");
				para.appendChild(Content3);
				document.getElementById("answer").appendChild(para);
				let num = 0;
				for (let i=0; i<5; i++) {
					num <<= 3;
					num += question[i];
				}
				const base_url = location.href.replace(location.hash, "");
				document.getElementById("answer_region").innerHTML
					= "å¦‚æœä½ æƒ³å’Œå¥½å‹åˆ†äº«æœ¬å±€çš„é—®é¢˜ï¼Œå¯ä»¥å¤åˆ¶ä»¥ä¸‹é“¾æ¥ï¼š"
					+ `<a href="${base_url}#${num}">${base_url}#${num}</a>`;
				if_success = true;
			}
			else{
				document.getElementById("answer_region").innerHTML=(round+1) + ":";
			}

			nownum = 0;
		}

		var hash_used = false;

		function refresh() {
			try {
				if (hash_used) {
					throw 1;
				} else {
					hash_used = true;
					if (location.hash === "") {
						throw 1;
					}
					let num = Number(location.hash.slice(1));
					if (Number.isNaN(num)) {
						throw 1;
					}
					let question_from_hash = [];
					for (let i=0; i<5; i++) {
						question_from_hash.unshift(num & 0b111);
						if (question_from_hash[0] >= 5) {
							throw 1;
						}
						num >>= 3;
					}
					question = question_from_hash;
				}
			}
			catch (e) {
				for (let i=0; i<5; i++) {
					question[i] = Math.floor((Math.random() * 5));
				}
			}

			document.getElementById("head").innerHTML="Chromle";
			document.getElementById("answer").innerHTML="";
			document.getElementById("answer_region").innerHTML="1:";
			round = 0;
			nownum = 0;
			answers_bool = true;
			if_success = false;
			document.getElementById("check_answer").innerHTML="æ˜¾ç¤ºç­”æ¡ˆ";
		}

		function match() {
			let location_num = 0;
			let answers_color_num = count(answers);
			let question_color_num = count(question);
			let num_num = 0;
			for (let i=0; i<5; i++) {
				if (question[i] === answers[i]) {
					location_num ++;
				}
				if ((answers_color_num[i] === question_color_num[i]) && (answers_color_num[i] !== 0)) {
					num_num++;
				}
			}
			return [location_num, num_num];
		}

		function count(array) {
			let color_num = [0,0,0,0,0];
			for (let i=0; i<5; i++) {
				color_num[array[i]] ++;
			}
			return color_num;
		}

		function show_answer() {
			let content = "";
			let button_content;
			if (!answers_bool) {
				button_content = "æ˜¾ç¤ºç­”æ¡ˆ";
				content = "Chromle";
			}
			if (answers_bool) {
				for (let i=0; i<5; i++) {
					content = content+" "+colors[question[i]];
				}
				button_content = "éšè—ç­”æ¡ˆ";
			}
			document.getElementById("head").innerHTML=content;
			document.getElementById("check_answer").innerHTML=button_content;
			answers_bool = !answers_bool;
		}

		function switch_char_color() {
			if (char_color_bool) {
				colors = ['çº¢', 'ç»¿', 'é»„', 'è“', 'ç´«'];
				for (let i = 0; i<5; i++) {
					document.getElementById(i).innerHTML=colors[i];
				}
			}
			else{
				colors = ['ğŸŸ¥', 'ğŸŸ©', 'ğŸŸ¨', 'ğŸŸ¦', 'ğŸŸª'];
				for (let i = 0; i<5; i++) {
					document.getElementById(i).innerHTML=colors[i];
				}
			}

			let para = document.createElement("p");
			para.setAttribute("style","color: green; font-size: 70%; margin: 0%");
			para.appendChild(document.createTextNode("å·²åˆ‡æ¢é¢œè‰²æ˜¾ç¤ºæ–¹å¼"));
			document.getElementById("answer").appendChild(para);
			char_color_bool = !char_color_bool;
		}
	</script>
</head>

<body>
	<div>
	<h1 id="head">Chromle</h1>
	<div style="font-size: 65%">
		è§„åˆ™ï¼šä¸€å…±æœ‰äº”ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®ä¼šéšæœºç”Ÿæˆçº¢ã€ç»¿ã€é»„ã€è“ã€ç´«äº”ç§é¢œè‰²ä¹‹ä¸€ï¼Œéœ€è¦æˆ‘ä»¬å»çŒœå‡ºç”Ÿæˆçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚<br>
		æ¯çŒœæµ‹ä¸€æ¬¡ï¼Œå¯å¾—åˆ°ä¸¤æ¡ä¿¡æ¯ï¼š
		<ol>
			<li>æœ‰å‡ ä¸ªä½ç½®ä¸Šå‡ºç°çš„é¢œè‰²æ˜¯æ­£ç¡®çš„ï¼›</li>
			<li>æœ‰å‡ ä¸ªé¢œè‰²å‡ºç°çš„æ¬¡æ•°æ˜¯æ­£ç¡®çš„ï¼ˆä¸åŒ…æ‹¬çŒœå¯¹å‡ºç°0æ¬¡çš„é¢œè‰²ï¼‰ã€‚</li>
		</ol>
		å¦‚ç”Ÿæˆâ€œé»„ ç´« ç´« ç´« çº¢â€ï¼ŒçŒœæµ‹â€œé»„ ç´« é»„ çº¢ çº¢â€ï¼Œä¼šå‡ºç°â€œ3ä¸ªä½ç½®é¢œè‰²æ­£ç¡® 0ç§é¢œè‰²æ•°é‡æ­£ç¡®â€ã€‚<br>
		å‡ºç°â€œ5ä¸ªä½ç½®é¢œè‰²æ­£ç¡®â€å³ç®—æˆåŠŸã€‚
	</div>
	<p id="answer"></p>
	<p></p>
	<p id="answer_region">1:</p>
	<p>
		<button id="0" onclick="choose(this.id)">çº¢</button>
		<button id="1" onclick="choose(this.id)">ç»¿</button>
		<button id="2" onclick="choose(this.id)">é»„</button>
		<button id="3" onclick="choose(this.id)">è“</button>
		<button id="4" onclick="choose(this.id)">ç´«</button>
	</p>
	<p>
		<button onclick="submit()">ç¡®å®š</button>
		<button onclick="del()">åˆ é™¤</button>
		<button onclick="refresh()">æ¢ä¸€å±€</button>
		<button onclick="show_answer()" id="check_answer">æ˜¾ç¤ºç­”æ¡ˆ</button>
	</p>
		<button onclick="switch_char_color()">åˆ‡æ¢é¢œè‰²æ˜¾ç¤ºæ–¹å¼</button>
	</div>
	<script>
		refresh();
	</script>
</body>
</html>